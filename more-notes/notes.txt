Muhsaf themes https://qurancomplex.gov.sa/isdarat-embed/
https://publications-img.qurancomplex.gov.sa/


15 line Madani Muhsaf
This file includes lines beginnings for all pages with the format [surah_no, ayah_no, 0_based_word_index]
first 2 pages has only 8 lines
other pages has 15 lines

all pages has one additional line (virtual line to know what is the end of last line)
line data is array as you see, if its length is 1 only like [1] it represents the surah name header. if its length is 2 only like [2,0] it represents basmallah. if its length is 3 it represents normal line like [1,1,0]

so [1] means surah name header for al fatiha
[2,0] means basmallah for surah al baqarah
[2,1,0] means first line of al baqarah which starts with ayah 1 with word index 0

the ayahs words is aligned with words from Quran Complex Hafs font latest version https://download.qurancomplex.gov.sa/resources_dev/UthmanicHafs_v17.zip from the json file there
this version 17 isn't different from some older version, but it IS different from Tanzil words in 6 places
so, I am admitting Quran Complex Hafs Words Not Tanzil as base

These differences are
Ayah index: 187 has different length, 1 differences
فَمَنۢ بَدَّلَهُۥ بَعۡدَ مَا سَمِعَهُۥ فَإِنَّمَآ إِثۡمُهُۥ عَلَى ٱلَّذِينَ يُبَدِّلُونَهُۥٓۚ إِنَّ ٱللَّهَ سَمِيعٌ عَلِيمٞ ١٨١
فَمَنۢ بَدَّلَهُۥ بَعْدَمَا سَمِعَهُۥ فَإِنَّمَآ إِثْمُهُۥ عَلَى ٱلَّذِينَ يُبَدِّلُونَهُۥٓ إِنَّ ٱللَّهَ سَمِيعٌ عَلِيمٌ
---
Ayah index: 1165 has different length, 1 differences
يُجَٰدِلُونَكَ فِي ٱلۡحَقِّ بَعۡدَ مَا تَبَيَّنَ كَأَنَّمَا يُسَاقُونَ إِلَى ٱلۡمَوۡتِ وَهُمۡ يَنظُرُونَ ٦
يُجَٰدِلُونَكَ فِى ٱلْحَقِّ بَعْدَمَا تَبَيَّنَ كَأَنَّمَا يُسَاقُونَ إِلَى ٱلْمَوْتِ وَهُمْ يَنظُرُونَ
---
Ayah index: 1743 has different length, 1 differences
وَكَذَٰلِكَ أَنزَلۡنَٰهُ حُكۡمًا عَرَبِيّٗاۚ وَلَئِنِ ٱتَّبَعۡتَ أَهۡوَآءَهُم بَعۡدَ مَا جَآءَكَ مِنَ ٱلۡعِلۡمِ مَا لَكَ مِنَ ٱللَّهِ مِن وَلِيّٖ وَلَا وَاقٖ ٣٧
وَكَذَٰلِكَ أَنزَلْنَٰهُ حُكْمًا عَرَبِيًّا وَلَئِنِ ٱتَّبَعْتَ أَهْوَآءَهُم بَعْدَمَا جَآءَكَ مِنَ ٱلْعِلْمِ مَا لَكَ مِنَ ٱللَّهِ مِن وَلِىٍّ وَلَا وَاقٍ
---
Ayah index: 1808 has different length, 1 differences
لَّوۡمَا تَأۡتِينَا بِٱلۡمَلَٰٓئِكَةِ إِن كُنتَ مِنَ ٱلصَّٰدِقِينَ ٧
لَّوْ مَا تَأْتِينَا بِٱلْمَلَٰٓئِكَةِ إِن كُنتَ مِنَ ٱلصَّٰدِقِينَ
---
Ayah index: 3178 has different length, 1 differences
وَتَفَقَّدَ ٱلطَّيۡرَ فَقَالَ مَالِيَ لَآ أَرَى ٱلۡهُدۡهُدَ أَمۡ كَانَ مِنَ ٱلۡغَآئِبِينَ ٢٠
وَتَفَقَّدَ ٱلطَّيْرَ فَقَالَ مَا لِىَ لَآ أَرَى ٱلْهُدْهُدَ أَمْ كَانَ مِنَ ٱلْغَآئِبِينَ
---
Ayah index: 3726 has different length, 1 differences
وَمَالِيَ لَآ أَعۡبُدُ ٱلَّذِي فَطَرَنِي وَإِلَيۡهِ تُرۡجَعُونَ ٢٢
وَمَا لِىَ لَآ أَعْبُدُ ٱلَّذِى فَطَرَنِى وَإِلَيْهِ تُرْجَعُونَ
---
6 ayah has different length
if your word base is Tanzil, I can update the data as you want, but I am recommending to use words from Quran Complex Hafs
in quranonline.net we display this data as lines with text-align: justify & with word-spacing: -.2em
With testing with 500px page, all pages are compatible with fonts 29.9px to 31.4px, so you can use 29.9 for all pages, you can make sure that font size is good by checking page 575 which has lowest font size 29.9px

I am not ruby dev, but I can help in implementation of this insha'Allah but please tell me what is the data source you are using
Another important note: There are 3 differences between quran font v2 and Quran Complex Hafs file,
word-262-(51-52)
word-378-(109-110)
word-441-(94-95)

This differences are important for Word Highlight which based on https://github.com/cpfair/quran-align (which based on Tanzil words)

I have scripts for comparing and editing quran-align data to be compatible with Quran Complex Hafs
sorry for this confusion, I can explain more if you want

This last file includes the character index of all signs of quran font v2 pages (Quarter signs, waqf and ibtida' and sujud signs and other signs that aren't words)
I can help in migrating from Tanzil text to Quran Complex Hafs Text
